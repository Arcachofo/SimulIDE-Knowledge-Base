MCUs are [[Modular]] Components, defined in a [[Definition file|Definition file]] representing different modules inside the MCU as: cpu, memories, I/O ports, timers, etc.

## Microcontrollers supported:

[[AVR]]<br>
[[PIC]]<br>
[[I51]]<br>
[[Arduino]]<br>

## Relevant topics:

[[Monitor]]<br>
[[Serial Monitor]]<br>
[[MCU Fuses]]<br>

---

## Basic Use:

To do a Microcontroller simulation just pick a Microcontroller from the left panel and drop in the circuit, then build the circuit you need to test your firmware.<br>
When your circuit is ready, Right-Click on the Microcontroller and select "Load firmware".
Select an .hex file to load to the  Microcontroller.<br>
If no error message is shown, it means that firmware was properly loaded.<br>

Microcontrollers in the simulation don't need a clock connected. The clock signal is always generated by the simulation.<br>
To set the Microcontroller clock speed:<br>
1. Right-click on the Microcontroller and select "Properties".<br>
2. Set "Frequency" property at the desired speed.

By default clock speed is set to 20 Mhz for Pic and 16 Mhz for Avr and Arduino.

Now you are ready to power the circuit and watch the simulation.

---

## Context Menu:

- **Load firmware:** load an hex file to the Microcontroller.
- **Reload firmware:** reload an hex file loaded previously.
- **Load EEPROM data from file:** load data from file to Microcontroller's EEPROM.
- **Save EEPROM data to file:** save Microcontroller's EEPROM to file.
- **Open [[Monitor]]:** open a monitor to watch RAM, ROM, Flash and other info.
- **Open [[Serial Monitor]]:** open a monitor to watch Serial communications.
- **[[MCUs#Properties:|Properties]]** opens properties dialog.

---

## Properties:

This is the Microcontroller's [[Properties dialog]].

### Main tab:

- **Frequency:**<br>
   Set oscillator frequency.<br>

- **Firmware:**<br>
   Shows the path to the hex file loaded.<br>

- **Reload hex at Simulation Start:**<br>
   Automatically reloads hex file at simulation start.<br>

![[mcu_props1.png]]
<br>

### Config tab:

These setting are equivalent to configuration bits ([[#MCU Fuses]]).<br>

- **Enable Reset Pin:**
   Use reset pin if multiplexed with I/O pin.<br>
   Reset Pin can't be used as I/O pin.<br>
   
- **External Oscillator:**
   Disables oscillator pins if multiplexed with I/O pins.<br>
   Pins can't be used as I/O pins.<br>
   
- **Enable WatchDog:**
   Enable/disable watchdog.<br>
   Enabling in configuration registers might be needed.<br>


![[mcu_props2.png]]

---

## MCU Fuses:


### PIC: 
fuses based on PGM Address.<br>

Fuses are contained in the hex file at special addresses.<br>
These are detected by the loadHex algorythm.<br>
Adress+value sent to PicConfigWord::setCfgWord which does the configuration:

- Oscillator type: Freq and Pins (McuIntOsc).
- Watchdog.
- Mclr Pin.
- Clock Out.


### AVR: 
fuses programmed directly.<br>

Configuration is done in Component properties->Config.

---

## Resources:

### Videos:
- [Microcontrollers basic use SimulIDE 1.0.0](https://www.youtube.com/watch?v=XcCq9B0rIDA)
- [Microcontroladores SimulIDE 1.0.0 (spanish)](https://www.youtube.com/watch?v=Qzu-brnP15s)
- [SimulIDE 1.0.0 multiple MCUs](https://www.youtube.com/watch?v=CcFM1lmQD_I)

## [[MCU dev]]

---
